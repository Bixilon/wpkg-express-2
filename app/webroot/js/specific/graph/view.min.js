var AppActionScriptsGraphView=AppActionScriptsGraphView||{};(function(f){function k(){f("#graphListMessages .alert").addClass("hidden")}function a(n){if(!n){return}var m=f("#msgGraph"+n);if(m.length===0){return}k();m.removeClass("hidden")}function l(){f("#graph-svg").html("")}function g(m){var n=f("#GraphVizGenerateForm");n.find("fieldset").attr("disabled",m);n.find("input").attr("disabled",m)}function j(m){var n=f("#linkDownloadGraph");if(m){n.addClass("disabled")}else{n.removeClass("disabled").off("click.MainAppScripts")}}function b(m,n,o){a("Progress");l();j(true);g(true)}function c(n,o,p,m){g(false);if(!n){a("NoData");return}k();j(false);f("#graph-svg").html(n);i();h()}function d(p,m,o,n){g(false);a("Error");l();if(p.status===403){location.reload()}}function e(){var n=f("#graph-svg svg")[0];if(!n){return}var m=svgPanZoom(n);m.resize();m.fit();m.center()}function i(){var r=f("#linkDownloadGraph");var m=f("#graph-svg svg")[0];var o=new XMLSerializer();var p=o.serializeToString(m);if(r.length===0){return}if(!p.match(/^<svg[^>]+xmlns="http\:\/\/www\.w3\.org\/2000\/svg"/)){p=p.replace(/^<svg/,'<svg xmlns="http://www.w3.org/2000/svg"')}if(!p.match(/^<svg[^>]+"http\:\/\/www\.w3\.org\/1999\/xlink"/)){p=p.replace(/^<svg/,'<svg xmlns:xlink="http://www.w3.org/1999/xlink"')}p='<?xml version="1.0" standalone="no"?>\r\n'+p;var n="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(p);var q=r.data("file-name");if(!q){q="graph.svg"}r.attr({href:n,download:q})}function h(){var m=f("#graph-svg svg")[0];if(!m){return}m.setAttribute("width","100%");m.setAttribute("preserveAspectRatio","xMinYMin meet");var n={maxZoom:30,controlIconsEnabled:true,zoomScaleSensitivity:0.5,fit:true,center:true};svgPanZoom(m,n);e()}AppActionScriptsGraphView.updateForm=function(){f("#GraphVizGenerateForm").off("submit.AppActionScriptsGraphView").on("submit.AppActionScriptsGraphView",function(m){m.preventDefault();f(this).ajaxSubmit({beforeSubmit:b,success:c,error:d})})};AppActionScriptsGraphView.updateCheckboxShowFull=function(){f("#GraphVizFullGraph").off("change.AppActionScriptsGraphView").on("change.AppActionScriptsGraphView",function(m){f("#GraphVizGenerateForm").trigger("submit")})};AppActionScriptsGraphView.updateWindowResize=function(){f(window).off("resize.AppActionScriptsGraphView").on("resize.AppActionScriptsGraphView",e)};return AppActionScriptsGraphView})(jQuery);$(function(){$(document).off("MainAppScripts:update.AppActionScriptsGraphView").on("MainAppScripts:update.AppActionScriptsGraphView",function(){AppActionScriptsGraphView.updateForm();AppActionScriptsGraphView.updateCheckboxShowFull();AppActionScriptsGraphView.updateWindowResize();if(!$("#graph-svg").data("graph-init")){$("#graph-svg").data("graph-init",true);$("#GraphVizGenerateForm").trigger("submit")}})});