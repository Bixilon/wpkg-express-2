var AppActionScriptsActionsAdd=AppActionScriptsActionsAdd||{};(function(b){function a(){var i=".form-edit-action";var k=b(i);var f=k.attr("action");var j=b("#PackageActionActionTypeId");var h=b("#PackageActionCommandTypeId");var e=null;var g="";if(!f){return}var d=f.match(/\.(?:mod|pop)$/);if(d){g=d[0]}f=f.replace(/(\/(action|command):[\d]*|\.(mod|pop)$)/g,"");f+="/action:"+j.val()+"/command:"+h.val()+g+" "+i;e=k.attr("data-toggle");k.parent().load(f,function(){if(e){b(i).attr("data-toggle",e)}b(document).trigger("MainAppScripts:update")})}function c(e,i,d,g,f){var h={query:e,"pkg-id":g,type:f};b.post(d,h,function(j){i(j)},"json").fail(function(){i([])})}AppActionScriptsActionsAdd.updateActionType=function(){b("#PackageActionActionTypeId").off("change.AppActionScriptsActionsAdd").on("change.AppActionScriptsActionsAdd",a)};AppActionScriptsActionsAdd.updateCommandType=function(){b("#PackageActionCommandTypeId").off("change.AppActionScriptsActionsAdd").on("change.AppActionScriptsActionsAdd",a)};AppActionScriptsActionsAdd.updateCommandTextarea=function(){var f=b("#PackageActionCommand").off("keypress.AppActionScriptsActionsAdd").on("keypress.AppActionScriptsActionsAdd",function(j){if(j.keyCode==13){j.preventDefault()}});if(f.length===0){return}var d=Textcomplete.editors.Textarea;var g=new d(f.get(0));var i=new Textcomplete(g);var e=f.data("autocomplete-url");var h=f.data("autocomplete-pkg-id");i.register([{match:/(%COMSPEC%\s+)(\/\w*)$/i,search:function(j,k){c(j,k,e,h,"command")},cache:true,replace:function(j){return"$1"+j}},{match:/(%)(\w+)$/,search:function(j,k){c(j,k,e,h,"variable")},cache:true,replace:function(j){return"$1"+j+"%"}},{match:/(\s+)(\/\w*)$/,search:function(j,k){c(j,k,e,h,"switch")},cache:true,replace:function(j){return"$1"+j}}],{debounce:500})};return AppActionScriptsActionsAdd})(jQuery);$(function(){$(document).off("MainAppScripts:update.AppActionScriptsActionsAdd").on("MainAppScripts:update.AppActionScriptsActionsAdd",function(){AppActionScriptsActionsAdd.updateActionType();AppActionScriptsActionsAdd.updateCommandType();AppActionScriptsActionsAdd.updateCommandTextarea()})});